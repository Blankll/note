# 线程安全性

线程安全：当多个线程访问一个对象时，如果不用考虑这些线程在运行时环境下的调度和交替执行，也不需要进行额外的同步，或者在调用方进行任何其他的协调操作，调用这个对象的行为都可以获得正确的结果，那这个对象是线程安全的。

### 需要考虑线程安全的情况

- 访问的变量或资源，会有并发风险，比如对象的属性，静态变量，共享缓存，数据库等
- 所有依赖时序的操作，即使每一步都是线程安全的，还是存在并发问题
- 不同的数据之间存在绑定关系时
- 使用非线程安全的类



- 原子性

  > 访问某个共享变量的操作从其执行线程之外的线程来看，该操作要么已经执行完毕，要么尚未发生，其他线程不会看到执行操作的中间结果

- 可见性

  > 一个线程对主内存的修改可以及时的被其他线程观察到

- 有序性

  > 

对象发布和初始化

对象发布：

- public的类可发布，其他方法中可以实例化对象
- return一个对象，对象就被发布出去了
- 对象作为一个参数传递给其他方法，实参的对象就被发布出去了】

对象逸出--对象发布到了不应该发布到的地方

- 方法返回给外部方法一个private对象
- 还未完成初始化(构造函数未执行完毕)时将对象提供给外部，如：
  - 在构造函数中未初始化完毕就this赋值
  - 隐式逸出-注册监听事件
  - 构造函数中运行线程